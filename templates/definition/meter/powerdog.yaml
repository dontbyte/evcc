template: powerdog
description: Powerdog
guidedsetup:
  enable: true
params:
- name: usage
  choice: [ "grid", "pv" ]
- name: host
  required: true
  example: 192.0.2.2
- name: port
  default: 502
render: |
  type: custom
  power:
  {{- if eq .usage "grid" }}
    source: calc #calculate current overall consumption + (current pv effort * (-1) )
    add:
    - source: modbus
      uri: {{ .host }}:{{ .port }} #ip-adress and port (default-port: 502)
      id: 1
      register:
        address: 40026 #register for overall consumption
        type: holding
        decode: int32
    - source: modbus
      uri: {{ .host }}:{{ .port }} #ip-adress and port (default-port: 502)
      id: 1
      register:
        address: 40002 #register for pv effort
        type: holding
        decode: int32
      scale: -1 #scale with -1 to get a substraction
  {{- end }}
  {{- if eq .usage "pv" }}
    type: modbus
    uri: {{ .host }}:{{ .port }} #ip-adress and port (default-port: 502)
    id: 1
    register:
      address: 40002 #register for pv effort
      type: holding
      decode: int32
  {{- end }}
